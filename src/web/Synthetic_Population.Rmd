---
title: "Synthetic Population"
output: html_document
---

The  goal of our project is to impute a synthetic population that represent those Accomack and Northampton communities  by combining information from various sources of data, administrative and survey data to get a representation of those rural communities down to the level of individual households and farms. That will be used as an input into agent based models for stakeholder decisions, and hydrological models to measure flood hazard, water supply, and groundwater salinization.  The use of synthetic populations is an approach that can retain aggregate population characteristics at larger community levels (e.g., Census block, neighborhood, farming sector) while constructing “synthetic” households using imputation methods without  compromising  privacy.


##**Methodology**
The Method used for the construction of Synthetic Population is **Iterative Proportional Fitting** because IPF is computationally efficient  and it involves resampling from microdata and can include housing data for more precise sub-block group estimation.

IPF estimates a joint table given marginal constraints

The **Procedure** is :

1. Adjust cells using marginal column totals; divide by (cell column sums/ marginal column totals)

2. Adjust cells using marginal row totals; divide by (cell row sums/ marginal row totals)

3. Iterate (1) and (2) until convergence

###**Resampling and adding locations**

- IPF produces a maximum entropy estimate of the joint table subject to constraints of the marginals

  + Our IPF output was a list with categories like Race, Income level, Age, Tenure and number of households
  
  + To be precise it was around 896 variables
  
####*IPF OUTPUT*  
![](www/ipfoutput1.png)</center>




```{r, layout="l-body-outset", echo = FALSE}
library(rmarkdown)
paged_table(readRDS("/home/jme6bk/github/CoastalFutures/Data_and_Codes/freq_IPF_output.RDS"))
```



- There is a **Resampling process** involved with microdata which is just simple **random sample** with replacement  

-  We sampled SERIALNO from the ACS PUMS data tables (see data - ACS) that matches each cell from the ipf output to create synthetic population  

- Final step of IPF involves attaching household geometry to the synthetic population. For that process we took the blackknight housing data, performed shape file conversion to abstract the latitiudes and longitudes and linked the coordinates with thier unique housing IDs to our IPF outputs. 


####*Northampton Synthetic Population*
```{r, layout="l-body-outset", echo = FALSE, results = 'asis'}
library(rmarkdown)
paged_table(readRDS("/home/jme6bk/github/CoastalFutures/Data_and_Codes/NorthamptonsampledfSF_Coords.RDS"))

```
####*Accomack Synthetic Population*
```{r, layout="l-body-outset", echo = FALSE, results = 'asis'}
library(rmarkdown)
paged_table(readRDS("/home/jme6bk/github/CoastalFutures/Data_and_Codes/AccomacksampledfSF_Coords.RDS"))

```


###**Methods to improve Sophistication**

- There are three methods to increase Sophistication

     + Choose a lat/long sampled uniformly over the Block Group
     
     + Sample from actual housing units
     
     + Match people to housing units  
     
     + Link IPF output and households based on income, taxes, and property value
  

###**Estimating Variability**

- To account for the error in the IPF procedure, we can repeat the steps over multiple runs for sample-based error estimates.

- To account for the sampling variability, resample the marginal tables for each run.

###**R Implementatiom**
In order to implement IPF procedure in R, there is a package called **mipfp**



